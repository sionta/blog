{% if page.comments == true and site.comments.provider %}
  {% assign PROVIDER_NAME = site.comments.provider %}
  {% assign PROVIDER_DATA = site.comments[PROVIDER_NAME] %}
  {% if include.only == 'html' %}
    <div
      {% if PROVIDER_NAME == 'disqus' %}
        id="disqus_thread"
      {% else %}
        id="site-comment"
      {% endif %}
      class="{{ PROVIDER_NAME }}"
      itemscope
      itemtype="https://schema.org/Comment"
      pageurl="{{ page.url | absolute_url }}"
    ></div>
  {% endif %}
  {% comment %}
    {% if include.only == 'script' %}
      <script>
        (window.themeMode =
          localStorage.getItem('theme') ||
          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')),
          (giscusTheme = themeMode === 'dark' ? 'dark_dimmed' : 'light'),
          (utterancesTheme = themeMode === 'dark' ? 'dark_dimmed' : 'light');
      </script>
      {% case PROVIDER_NAME %}
        {% when 'disqus' %}
          <script>
            /**
             *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
            var disqus_config = function () {
              this.page.url = '{{ page.url | absolute_url }}';
              this.page.identifier = '{{ page.id }}';
            };
            (function () {
              // DON'T EDIT BELOW THIS LINE
              var d = document,
                s = d.createElement('script');
              s.src = 'https://{{ PROVIDER_DATA.shortname }}.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.getElementById('site-comment') || d.head || d.body).appendChild(s);
            })();
          </script>
          <noscript
            >Please enable JavaScript to view the
            <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript
          >
        {% when 'giscus' %}
          <script type="text/javascript">
            (function () {
              const themeMode =
                  localStorage.getItem('theme') ||
                  (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'),
                giscusTheme = themeMode === 'dark' ? 'dark_dimmed' : 'light';

              const giscusAttributes = {
                src: 'https://giscus.app/client.js',
                'data-repo': '{{ PROVIDER_DATA.repo }}',
                'data-repo-id': '{{ PROVIDER_DATA.repo_id }}',
                'data-category': '{{ PROVIDER_DATA.category }}',
                'data-category-id': '{{ PROVIDER_DATA.category_id }}',
                'data-mapping': "{{ PROVIDER_DATA.mapping | default: 'pathname' }}",
                'data-strict': '{{ PROVIDER_DATA.strict | default: 0 }}',
                'data-reactions-enabled': '{{ PROVIDER_DATA.reactions_enabled | default: 1 }}',
                'data-emit-metadata': '{{ PROVIDER_DATA.metadata | default: 0 }}',
                'data-theme': giscusTheme,
                'data-lang': "{{ PROVIDER_DATA.lang | default: site.lang | default: 'en' }}",
                'data-loading': 'lazy',
                crossorigin: 'anonymous',
                async: true,
              };

              const giscusScript = document.createElement('script');
              Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
              document.getElementById('site-comment').appendChild(giscusScript);
            })();
          </script>
        {% when 'utterances' %}
          <script type="text/javascript">
            (function () {
              const themeMode =
                  localStorage.getItem('theme') ||
                  (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'),
                utterancesTheme = themeMode === 'dark' ? 'github-dark' : 'github-light';

              const utterancesAttributes = {
                src: 'https://utteranc.es/client.js',
                repo: '{{ PROVIDER_DATA.repo }}',
                'issue-term': "{{ PROVIDER_DATA.issue_term | default: 'pathname' }}",
                theme: utterancesTheme,
                crossorigin: 'anonymous',
                async: true,
              };

              const utterancesScript = document.createElement('script');
              Object.entries(utterancesAttributes).forEach(([key, value]) => utterancesScript.setAttribute(key, value));
              document.getElementById('site-comment').appendChild(utterancesScript);
            })();
          </script>
      {% endcase %}
    {% endif %}
  {% endcomment %}
{% endif %}
